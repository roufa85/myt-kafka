
cd /etc/prometheus

sudo wget -O kafka.yml https://raw.githubusercontent.com/prometheus/jmx_exporter/master/example_configs/kafka-2_0_0.yml

sudo wget -O zookeeper.yml https://raw.githubusercontent.com/prometheus/jmx_exporter/master/example_configs/zookeeper.yaml

sudo wget https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.12.0/jmx_prometheus_javaagent-0.12.0.jar


sudo chown prometheus:prometheus *.yml 

sudo chown prometheus:prometheus jmx_prometheus_javaagent-0.12.0.jar 

sudo chmod a+x jmx_prometheus_javaagent-0.12.0.jar

sudo JMX_PORT=7081 \
KAFKA_OPTS='-javaagent:/etc/prometheus/jmx_prometheus_javaagent-0.12.0.jar=7071:/etc/prometheus/kafka.yml' \
/opt/kafka/bin/kafka-server-start.sh -daemon /opt/kafka/config/server.properties

ps ax | grep -i 'kafka.Kafka' | grep -v grep | awk '{print $1}'


sudo EXTRA_ARGS="-name zookeeper -loggc -javaagent:/etc/prometheus/jmx_prometheus_javaagent-0.12.0.jar=7072:/etc/prometheus/zookeeper.yml" \
/opt/kafka/bin/zookeeper-server-start.sh -daemon /opt/kafka/config/zookeeper.properties
